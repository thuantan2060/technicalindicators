{"version":3,"file":"MACD.js","names":["_indicator","require","_SMA","_EMA","MACDInput","IndicatorInput","SimpleMAOscillator","SimpleMASignal","fastPeriod","slowPeriod","signalPeriod","constructor","values","exports","MACDOutput","MACD","signal","histogram","Indicator","result","generator","input","oscillatorMAtype","SMA","EMA","signalMAtype","fastMAProducer","period","format","v","slowMAProducer","signalMAProducer","index","tick","fast","slow","nextValue","undefined","isNaN","next","forEach","value","push","calculate","macd","price","reverseInputs","reversedInput","reverse"],"sources":["../../src/moving_averages/MACD.ts"],"sourcesContent":["/**\r\n * Created by AAravindan on 5/4/16.\r\n */\r\nimport { Indicator, IndicatorInput } from '../indicator/indicator';\r\nimport { SMA } from './SMA';\r\nimport { EMA } from './EMA';\r\n\r\nexport class MACDInput extends IndicatorInput {\r\n    SimpleMAOscillator:boolean = true;\r\n    SimpleMASignal:boolean = true;\r\n    fastPeriod:number;\r\n    slowPeriod:number;\r\n    signalPeriod:number;\r\n    constructor(public values:number[]) {\r\n        super();\r\n    }\r\n}\r\n\r\nexport class MACDOutput {\r\n    MACD?:number\r\n    signal?:number\r\n    histogram?:number\r\n}\r\n\r\nexport class MACD extends Indicator{\r\n    result : MACDOutput[];\r\n    generator:IterableIterator<MACDOutput | undefined>;\r\n    constructor(input:MACDInput) {\r\n      super(input);\r\n      var oscillatorMAtype = input.SimpleMAOscillator ? SMA : EMA;\r\n      var signalMAtype   = input.SimpleMASignal ? SMA : EMA;\r\n      var fastMAProducer = new oscillatorMAtype({period : input.fastPeriod, values : [], format : (v) => {return v}});\r\n      var slowMAProducer = new oscillatorMAtype({period : input.slowPeriod, values : [], format : (v) => {return v}});\r\n      var signalMAProducer = new signalMAtype({period : input.signalPeriod, values : [], format : (v) => {return v}});\r\n      var format = this.format;\r\n      this.result = [];\r\n\r\n      this.generator = (function* (){\r\n        var index = 0;\r\n        var tick;\r\n        var MACD:number|undefined, signal:number|undefined, histogram:number|undefined, fast:number|undefined, slow:number|undefined;\r\n        while (true) {\r\n          if(index < input.slowPeriod){\r\n            tick = yield;\r\n            fast = fastMAProducer.nextValue(tick);\r\n            slow = slowMAProducer.nextValue(tick);\r\n            index++;\r\n            continue;\r\n          }\r\n          if(fast && slow) { //Just for typescript to be happy\r\n            MACD = fast - slow;\r\n            signal = signalMAProducer.nextValue(MACD);\r\n          } \r\n          histogram = MACD - signal;\r\n          tick = yield({\r\n            //fast : fast,\r\n            //slow : slow,\r\n            MACD : format(MACD),\r\n            signal : signal ? format(signal) : undefined,\r\n            histogram : isNaN(histogram) ? undefined : format(histogram)\r\n          })\r\n          fast = fastMAProducer.nextValue(tick);\r\n          slow = slowMAProducer.nextValue(tick);\r\n        }\r\n      })();\r\n\r\n      this.generator.next();\r\n\r\n      input.values.forEach((tick) => {\r\n        var result = this.generator.next(tick);\r\n        if(result.value != undefined){\r\n          this.result.push(result.value);\r\n        }\r\n      });\r\n    }\r\n\r\n    static calculate=macd;\r\n\r\n    nextValue(price:number):MACDOutput | undefined {\r\n        var result = this.generator.next(price).value;\r\n        return result;\r\n    };\r\n}\r\n\r\nexport function macd(input:MACDInput):MACDOutput[] {\r\n       Indicator.reverseInputs(input);\r\n        var result = new MACD(input).result;\r\n        if(input.reversedInput) {\r\n            result.reverse();\r\n        }\r\n        Indicator.reverseInputs(input);\r\n        return result;\r\n    };"],"mappings":";;;;;;;AAGA,IAAAA,UAAA,GAAAC,OAAA;AACA,IAAAC,IAAA,GAAAD,OAAA;AACA,IAAAE,IAAA,GAAAF,OAAA;AALA;AACA;AACA;;AAKO,MAAMG,SAAS,SAASC,yBAAc,CAAC;EAC1CC,kBAAkB,GAAW,IAAI;EACjCC,cAAc,GAAW,IAAI;EAC7BC,UAAU;EACVC,UAAU;EACVC,YAAY;EACZC,WAAWA,CAAQC,MAAe,EAAE;IAChC,KAAK,CAAC,CAAC;IAAC,KADOA,MAAe,GAAfA,MAAe;EAElC;AACJ;AAACC,OAAA,CAAAT,SAAA,GAAAA,SAAA;AAEM,MAAMU,UAAU,CAAC;EACpBC,IAAI;EACJC,MAAM;EACNC,SAAS;AACb;AAACJ,OAAA,CAAAC,UAAA,GAAAA,UAAA;AAEM,MAAMC,IAAI,SAASG,oBAAS;EAC/BC,MAAM;EACNC,SAAS;EACTT,WAAWA,CAACU,KAAe,EAAE;IAC3B,KAAK,CAACA,KAAK,CAAC;IACZ,IAAIC,gBAAgB,GAAGD,KAAK,CAACf,kBAAkB,GAAGiB,QAAG,GAAGC,QAAG;IAC3D,IAAIC,YAAY,GAAKJ,KAAK,CAACd,cAAc,GAAGgB,QAAG,GAAGC,QAAG;IACrD,IAAIE,cAAc,GAAG,IAAIJ,gBAAgB,CAAC;MAACK,MAAM,EAAGN,KAAK,CAACb,UAAU;MAAEI,MAAM,EAAG,EAAE;MAAEgB,MAAM,EAAIC,CAAC,IAAK;QAAC,OAAOA,CAAC;MAAA;IAAC,CAAC,CAAC;IAC/G,IAAIC,cAAc,GAAG,IAAIR,gBAAgB,CAAC;MAACK,MAAM,EAAGN,KAAK,CAACZ,UAAU;MAAEG,MAAM,EAAG,EAAE;MAAEgB,MAAM,EAAIC,CAAC,IAAK;QAAC,OAAOA,CAAC;MAAA;IAAC,CAAC,CAAC;IAC/G,IAAIE,gBAAgB,GAAG,IAAIN,YAAY,CAAC;MAACE,MAAM,EAAGN,KAAK,CAACX,YAAY;MAAEE,MAAM,EAAG,EAAE;MAAEgB,MAAM,EAAIC,CAAC,IAAK;QAAC,OAAOA,CAAC;MAAA;IAAC,CAAC,CAAC;IAC/G,IAAID,MAAM,GAAG,IAAI,CAACA,MAAM;IACxB,IAAI,CAACT,MAAM,GAAG,EAAE;IAEhB,IAAI,CAACC,SAAS,GAAI,aAAY;MAC5B,IAAIY,KAAK,GAAG,CAAC;MACb,IAAIC,IAAI;MACR,IAAIlB,IAAqB,EAAEC,MAAuB,EAAEC,SAA0B,EAAEiB,IAAqB,EAAEC,IAAqB;MAC5H,OAAO,IAAI,EAAE;QACX,IAAGH,KAAK,GAAGX,KAAK,CAACZ,UAAU,EAAC;UAC1BwB,IAAI,GAAG,KAAK;UACZC,IAAI,GAAGR,cAAc,CAACU,SAAS,CAACH,IAAI,CAAC;UACrCE,IAAI,GAAGL,cAAc,CAACM,SAAS,CAACH,IAAI,CAAC;UACrCD,KAAK,EAAE;UACP;QACF;QACA,IAAGE,IAAI,IAAIC,IAAI,EAAE;UAAE;UACjBpB,IAAI,GAAGmB,IAAI,GAAGC,IAAI;UAClBnB,MAAM,GAAGe,gBAAgB,CAACK,SAAS,CAACrB,IAAI,CAAC;QAC3C;QACAE,SAAS,GAAGF,IAAI,GAAGC,MAAM;QACzBiB,IAAI,GAAG,MAAM;UACX;UACA;UACAlB,IAAI,EAAGa,MAAM,CAACb,IAAI,CAAC;UACnBC,MAAM,EAAGA,MAAM,GAAGY,MAAM,CAACZ,MAAM,CAAC,GAAGqB,SAAS;UAC5CpB,SAAS,EAAGqB,KAAK,CAACrB,SAAS,CAAC,GAAGoB,SAAS,GAAGT,MAAM,CAACX,SAAS;QAC7D,CAAE;QACFiB,IAAI,GAAGR,cAAc,CAACU,SAAS,CAACH,IAAI,CAAC;QACrCE,IAAI,GAAGL,cAAc,CAACM,SAAS,CAACH,IAAI,CAAC;MACvC;IACF,CAAC,CAAE,CAAC;IAEJ,IAAI,CAACb,SAAS,CAACmB,IAAI,CAAC,CAAC;IAErBlB,KAAK,CAACT,MAAM,CAAC4B,OAAO,CAAEP,IAAI,IAAK;MAC7B,IAAId,MAAM,GAAG,IAAI,CAACC,SAAS,CAACmB,IAAI,CAACN,IAAI,CAAC;MACtC,IAAGd,MAAM,CAACsB,KAAK,IAAIJ,SAAS,EAAC;QAC3B,IAAI,CAAClB,MAAM,CAACuB,IAAI,CAACvB,MAAM,CAACsB,KAAK,CAAC;MAChC;IACF,CAAC,CAAC;EACJ;EAEA,OAAOE,SAAS,GAACC,IAAI;EAErBR,SAASA,CAACS,KAAY,EAAyB;IAC3C,IAAI1B,MAAM,GAAG,IAAI,CAACC,SAAS,CAACmB,IAAI,CAACM,KAAK,CAAC,CAACJ,KAAK;IAC7C,OAAOtB,MAAM;EACjB;AACJ;AAACN,OAAA,CAAAE,IAAA,GAAAA,IAAA;AAEM,SAAS6B,IAAIA,CAACvB,KAAe,EAAe;EAC5CH,oBAAS,CAAC4B,aAAa,CAACzB,KAAK,CAAC;EAC7B,IAAIF,MAAM,GAAG,IAAIJ,IAAI,CAACM,KAAK,CAAC,CAACF,MAAM;EACnC,IAAGE,KAAK,CAAC0B,aAAa,EAAE;IACpB5B,MAAM,CAAC6B,OAAO,CAAC,CAAC;EACpB;EACA9B,oBAAS,CAAC4B,aAAa,CAACzB,KAAK,CAAC;EAC9B,OAAOF,MAAM;AACjB;AAAC","ignoreList":[]}