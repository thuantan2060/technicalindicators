{"version":3,"file":"HeikinAshi.js","names":["_StockData","require","_indicator","HeikinAshiInput","IndicatorInput","low","open","volume","high","close","timestamp","exports","HeikinAshi","Indicator","result","generator","constructor","input","format","CandleList","lastOpen","lastHigh","lastLow","Infinity","lastClose","lastVolume","lastTimestamp","candleData","calculated","newClose","newOpen","newHigh","Math","max","newLow","min","next","forEach","tick","index","value","push","calculate","heikinashi","nextValue","price","reverseInputs","reversedInput","reverse"],"sources":["../../src/chart_types/HeikinAshi.ts"],"sourcesContent":["import { CandleData, CandleList } from '../StockData';\r\n/**\r\n * Created by AAravindan on 5/4/16.\r\n */\r\nimport { Indicator, IndicatorInput } from '../indicator/indicator';\r\n\r\nexport class HeikinAshiInput extends IndicatorInput {\r\n    low? : number[]\r\n    open? : number[]\r\n    volume? : number[]\r\n    high? : number[]\r\n    close? : number[]\r\n    timestamp? : number[]\r\n}\r\n\r\nexport class HeikinAshi extends Indicator{\r\n    result : CandleList;\r\n    generator:IterableIterator<CandleData | undefined>;\r\n    constructor(input:HeikinAshiInput) {\r\n      super(input);\r\n      var format = this.format;\r\n      this.result = new CandleList();\r\n\r\n      let lastOpen:number = null;\r\n      let lastHigh = 0;\r\n      let lastLow = Infinity;\r\n      let lastClose = 0;\r\n      let lastVolume = 0;\r\n      let lastTimestamp = 0;\r\n\r\n      this.generator = (function* (){\r\n          let candleData = yield;\r\n          let calculated = null;\r\n          while (true) {\r\n            if(lastOpen === null) {\r\n                lastOpen = (candleData.close + candleData.open) / 2 ;\r\n                lastHigh = candleData.high;\r\n                lastLow = candleData.low;\r\n                lastClose = (candleData.close + candleData.open + candleData.high + candleData.low) / 4;\r\n                lastVolume = (candleData.volume || 0);\r\n                lastTimestamp = (candleData.timestamp || 0);\r\n                calculated = <CandleData>{\r\n                    open : lastOpen,\r\n                    high : lastHigh,\r\n                    low : lastLow,\r\n                    close : lastClose,\r\n                    volume : candleData.volume || 0,\r\n                    timestamp : (candleData.timestamp || 0)\r\n                };\r\n            } else {\r\n                let newClose = (candleData.close + candleData.open + candleData.high + candleData.low) / 4\r\n                let newOpen = (lastOpen + lastClose)/ 2;\r\n                let newHigh = Math.max(newOpen, newClose, candleData.high);\r\n                let newLow = Math.min(candleData.low, newOpen, newClose);\r\n                calculated = <any>{\r\n                    close : newClose,\r\n                    open : newOpen,\r\n                    high : newHigh,\r\n                    low : newLow,\r\n                    volume : (candleData.volume || 0),\r\n                    timestamp : (candleData.timestamp || 0)\r\n                };\r\n                lastClose = newClose;\r\n                lastOpen = newOpen;\r\n                lastHigh = newHigh;\r\n                lastLow = newLow;\r\n            }\r\n            candleData = yield calculated;\r\n          }\r\n      })();\r\n\r\n      this.generator.next();\r\n      input.low.forEach((tick, index) => {\r\n            var result = this.generator.next({ \r\n                open : input.open[index],\r\n                high : input.high[index],\r\n                low : input.low[index],\r\n                close : input.close[index],\r\n                volume : input.volume ? input.volume[index] : input.volume,\r\n                timestamp : input.timestamp ? input.timestamp[index] : input.timestamp\r\n            });\r\n            if(result.value){\r\n                this.result.open.push(result.value.open)\r\n                this.result.high.push(result.value.high)\r\n                this.result.low.push(result.value.low)\r\n                this.result.close.push(result.value.close)\r\n                this.result.volume.push(result.value.volume)\r\n                this.result.timestamp.push(result.value.timestamp)\r\n            }\r\n      });\r\n    }\r\n\r\n    static calculate=heikinashi;\r\n\r\n    nextValue(price:CandleData):CandleData | undefined {\r\n        var result = this.generator.next(price).value;\r\n        return result;\r\n    };\r\n}\r\n\r\nexport function heikinashi(input:HeikinAshiInput):CandleList {\r\n       Indicator.reverseInputs(input);\r\n        var result = new HeikinAshi(input).result;\r\n        if(input.reversedInput) {\r\n            result.open.reverse();\r\n            result.high.reverse();\r\n            result.low.reverse();\r\n            result.close.reverse();\r\n            result.volume.reverse();\r\n            result.timestamp.reverse();\r\n        }\r\n        Indicator.reverseInputs(input);\r\n        return result;\r\n    };"],"mappings":"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","ignoreList":[]}