{"version":3,"file":"AverageLoss.js","names":["_indicator","require","AvgLossInput","IndicatorInput","values","period","exports","AverageLoss","Indicator","generator","constructor","input","format","currentValue","counter","lossSum","avgLoss","loss","lastValue","undefined","next","result","forEach","tick","value","push","calculate","averageloss","nextValue","price","reverseInputs","reversedInput","reverse"],"sources":["../../src/Utils/AverageLoss.ts"],"sourcesContent":["import { Indicator, IndicatorInput } from '../indicator/indicator';\r\nexport class AvgLossInput extends IndicatorInput {\r\n  values:number[]\r\n  period:number\r\n}\r\n\r\nexport class AverageLoss extends Indicator {\r\n  generator:IterableIterator<number | undefined>;\r\n  constructor(input:AvgLossInput) {\r\n    super(input);\r\n    let values = input.values;\r\n    let period = input.period;\r\n    let format = this.format;\r\n\r\n    this.generator = (function* (period){\r\n      var currentValue = yield;\r\n      var counter = 1;\r\n      var lossSum = 0;\r\n      var avgLoss;\r\n      var loss;\r\n      var lastValue = currentValue;\r\n      currentValue = yield\r\n      while(true){\r\n        loss = lastValue - currentValue;\r\n        loss = loss > 0 ? loss : 0;\r\n        if(loss > 0){\r\n          lossSum = lossSum + loss;\r\n        }\r\n        if(counter < period){\r\n          counter++;\r\n        }\r\n        else if(avgLoss === undefined){ \r\n          avgLoss = lossSum / period;\r\n        }else {\r\n          avgLoss = ((avgLoss * (period-1)) + loss)/period;\r\n        }\r\n        lastValue = currentValue;\r\n        avgLoss = (avgLoss!==undefined) ? format(avgLoss) : undefined;\r\n        currentValue = yield avgLoss;\r\n      }\r\n    })(period);\r\n\r\n    this.generator.next();\r\n\r\n    this.result = [];\r\n\r\n    values.forEach((tick:number) => {\r\n      var result = this.generator.next(tick);\r\n      if(result.value !== undefined){\r\n        this.result.push(result.value);\r\n      }\r\n    });\r\n  }\r\n\r\n  static calculate = averageloss;\r\n\r\n    nextValue(price:number):number | undefined {\r\n        return this.generator.next(price).value;\r\n    };\r\n} \r\n\r\nexport function averageloss(input:AvgLossInput):number[] {\r\n       Indicator.reverseInputs(input);\r\n        var result = new AverageLoss(input).result;\r\n        if(input.reversedInput) {\r\n            result.reverse();\r\n        }\r\n        Indicator.reverseInputs(input);\r\n        return result;\r\n    };\r\n"],"mappings":";;;;;;;AAAA,IAAAA,UAAA,GAAAC,OAAA;AACO,MAAMC,YAAY,SAASC,yBAAc,CAAC;EAC/CC,MAAM;EACNC,MAAM;AACR;AAACC,OAAA,CAAAJ,YAAA,GAAAA,YAAA;AAEM,MAAMK,WAAW,SAASC,oBAAS,CAAC;EACzCC,SAAS;EACTC,WAAWA,CAACC,KAAkB,EAAE;IAC9B,KAAK,CAACA,KAAK,CAAC;IACZ,IAAIP,MAAM,GAAGO,KAAK,CAACP,MAAM;IACzB,IAAIC,MAAM,GAAGM,KAAK,CAACN,MAAM;IACzB,IAAIO,MAAM,GAAG,IAAI,CAACA,MAAM;IAExB,IAAI,CAACH,SAAS,GAAI,WAAWJ,MAAM,EAAC;MAClC,IAAIQ,YAAY,GAAG,KAAK;MACxB,IAAIC,OAAO,GAAG,CAAC;MACf,IAAIC,OAAO,GAAG,CAAC;MACf,IAAIC,OAAO;MACX,IAAIC,IAAI;MACR,IAAIC,SAAS,GAAGL,YAAY;MAC5BA,YAAY,GAAG,KAAK;MACpB,OAAM,IAAI,EAAC;QACTI,IAAI,GAAGC,SAAS,GAAGL,YAAY;QAC/BI,IAAI,GAAGA,IAAI,GAAG,CAAC,GAAGA,IAAI,GAAG,CAAC;QAC1B,IAAGA,IAAI,GAAG,CAAC,EAAC;UACVF,OAAO,GAAGA,OAAO,GAAGE,IAAI;QAC1B;QACA,IAAGH,OAAO,GAAGT,MAAM,EAAC;UAClBS,OAAO,EAAE;QACX,CAAC,MACI,IAAGE,OAAO,KAAKG,SAAS,EAAC;UAC5BH,OAAO,GAAGD,OAAO,GAAGV,MAAM;QAC5B,CAAC,MAAK;UACJW,OAAO,GAAG,CAAEA,OAAO,IAAIX,MAAM,GAAC,CAAC,CAAC,GAAIY,IAAI,IAAEZ,MAAM;QAClD;QACAa,SAAS,GAAGL,YAAY;QACxBG,OAAO,GAAIA,OAAO,KAAGG,SAAS,GAAIP,MAAM,CAACI,OAAO,CAAC,GAAGG,SAAS;QAC7DN,YAAY,GAAG,MAAMG,OAAO;MAC9B;IACF,CAAC,CAAEX,MAAM,CAAC;IAEV,IAAI,CAACI,SAAS,CAACW,IAAI,CAAC,CAAC;IAErB,IAAI,CAACC,MAAM,GAAG,EAAE;IAEhBjB,MAAM,CAACkB,OAAO,CAAEC,IAAW,IAAK;MAC9B,IAAIF,MAAM,GAAG,IAAI,CAACZ,SAAS,CAACW,IAAI,CAACG,IAAI,CAAC;MACtC,IAAGF,MAAM,CAACG,KAAK,KAAKL,SAAS,EAAC;QAC5B,IAAI,CAACE,MAAM,CAACI,IAAI,CAACJ,MAAM,CAACG,KAAK,CAAC;MAChC;IACF,CAAC,CAAC;EACJ;EAEA,OAAOE,SAAS,GAAGC,WAAW;EAE5BC,SAASA,CAACC,KAAY,EAAqB;IACvC,OAAO,IAAI,CAACpB,SAAS,CAACW,IAAI,CAACS,KAAK,CAAC,CAACL,KAAK;EAC3C;AACJ;AAAClB,OAAA,CAAAC,WAAA,GAAAA,WAAA;AAEM,SAASoB,WAAWA,CAAChB,KAAkB,EAAW;EAClDH,oBAAS,CAACsB,aAAa,CAACnB,KAAK,CAAC;EAC7B,IAAIU,MAAM,GAAG,IAAId,WAAW,CAACI,KAAK,CAAC,CAACU,MAAM;EAC1C,IAAGV,KAAK,CAACoB,aAAa,EAAE;IACpBV,MAAM,CAACW,OAAO,CAAC,CAAC;EACpB;EACAxB,oBAAS,CAACsB,aAAa,CAACnB,KAAK,CAAC;EAC9B,OAAOU,MAAM;AACjB;AAAC","ignoreList":[]}