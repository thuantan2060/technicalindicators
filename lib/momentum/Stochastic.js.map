{"version":3,"file":"Stochastic.js","names":["_indicator","require","_FixedSizeLinkedList","_interopRequireDefault","_SMA","StochasticInput","IndicatorInput","period","low","high","close","signalPeriod","exports","StochasticOutput","k","d","Stochastic","Indicator","result","generator","constructor","input","lows","highs","closes","format","length","index","pastHighPeriods","LinkedList","pastLowPeriods","dSma","SMA","values","v","tick","push","periodLow","periodHigh","isNaN","nextValue","undefined","next","forEach","value","calculate","stochastic","nextResult","reverseInputs","reversedInput","reverse"],"sources":["../../src/momentum/Stochastic.ts"],"sourcesContent":["import { IndicatorInput, Indicator } from '../indicator/indicator';\r\n/**\r\n * Created by AAravindan on 5/10/16.\r\n */\r\n\"use strict\"\r\n\r\nimport LinkedList from '../Utils/FixedSizeLinkedList';\r\nimport { SMA }  from '../moving_averages/SMA';\r\n\r\nexport class StochasticInput extends IndicatorInput{\r\n  period:number;\r\n  low:number[];\r\n  high:number[];\r\n  close:number[];\r\n  signalPeriod:number;\r\n};\r\n\r\nexport class StochasticOutput{\r\n  k:number;\r\n  d:number;\r\n};\r\n\r\nexport class Stochastic extends Indicator {\r\n  result:StochasticOutput[]\r\n  generator:IterableIterator<StochasticOutput | undefined>;\r\n  constructor (input:StochasticInput) {\r\n    super(input);\r\n    let lows = input.low;\r\n    let highs = input.high;\r\n    let closes = input.close;\r\n    let period = input.period;\r\n    let signalPeriod = input.signalPeriod;\r\n    let format = this.format;\r\n    if(!((lows.length === highs.length) && (highs.length === closes.length) )){\r\n      throw ('Inputs(low,high, close) not of equal size');\r\n    }\r\n    this.result = [];\r\n    //%K = (Current Close - Lowest Low)/(Highest High - Lowest Low) * 100\r\n    //%D = 3-day SMA of %K\r\n    //\r\n    //Lowest Low = lowest low for the look-back period\r\n    //Highest High = highest high for the look-back period\r\n    //%K is multiplied by 100 to move the decimal point two places\r\n    this.generator = (function* (){\r\n      let index = 1;\r\n      let pastHighPeriods = new LinkedList(period, true, false);\r\n      let pastLowPeriods = new LinkedList(period, false, true);\r\n      let dSma = new SMA({\r\n        period : signalPeriod,\r\n        values : [],\r\n        format : (v) => {return v}\r\n      });\r\n      let k,d;\r\n      var tick = yield;\r\n      while (true) {\r\n        pastHighPeriods.push(tick.high);\r\n        pastLowPeriods.push(tick.low);\r\n        if(index < period){\r\n          index++;\r\n          tick = yield;\r\n          continue;\r\n        }\r\n        let periodLow = pastLowPeriods.periodLow;\r\n        k = (tick.close - periodLow) / (pastHighPeriods.periodHigh - periodLow) * 100;\r\n        k = isNaN(k) ? 0 : k; //This happens when the close, high and low are same for the entire period; Bug fix for \r\n        d = dSma.nextValue(k);\r\n        tick = yield {\r\n          k : format(k),\r\n          d : (d !== undefined) ? format(d) : undefined\r\n        }\r\n      }\r\n    })();\r\n\r\n    this.generator.next();\r\n\r\n    lows.forEach((tick, index) => {\r\n      var result = this.generator.next({\r\n        high : highs[index],\r\n        low  : lows[index],\r\n        close : closes[index]\r\n      });\r\n      if(result.value !== undefined){\r\n        this.result.push(result.value);\r\n      }\r\n    });\r\n  };\r\n\r\n  static calculate = stochastic\r\n\r\n  nextValue (input:StochasticInput):StochasticOutput {\r\n    let nextResult = this.generator.next(input);\r\n    if(nextResult.value !== undefined)\r\n      return nextResult.value;\r\n  };\r\n}\r\n\r\nexport function stochastic(input:StochasticInput):StochasticOutput[] {\r\n        Indicator.reverseInputs(input);\r\n        var result = new Stochastic(input).result;\r\n        if(input.reversedInput) {\r\n            result.reverse();\r\n        }\r\n        Indicator.reverseInputs(input);\r\n        return result;\r\n    };"],"mappings":"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","ignoreList":[]}