{"version":3,"file":"ADX.js","names":["_WilderSmoothing","require","_indicator","_MinusDM","_PlusDM","_TrueRange","_WEMA","ADXInput","IndicatorInput","high","low","close","period","exports","ADXOutput","adx","pdi","mdi","ADX","Indicator","result","generator","constructor","input","lows","highs","closes","format","plusDM","PDM","minusDM","MDM","emaPDM","WilderSmoothing","values","v","emaMDM","emaTR","emaDX","WEMA","tr","TrueRange","length","tick","index","lastATR","lastAPDM","lastAMDM","lastPDI","lastMDI","lastDX","smoothedDX","calcTr","nextValue","calcPDM","calcMDM","undefined","diDiff","Math","abs","diSum","next","forEach","value","push","calculate","price","reverseInputs","reversedInput","reverse"],"sources":["../../src/directionalmovement/ADX.ts"],"sourcesContent":["import { WilderSmoothing } from '../moving_averages/WilderSmoothing';\r\nimport { Indicator, IndicatorInput } from '../indicator/indicator';\r\nimport { MDM } from   './MinusDM';\r\nimport { PDM } from    './PlusDM';\r\nimport { TrueRange } from './TrueRange';\r\nimport { SMA } from       '../moving_averages/SMA';\r\nimport { WEMA } from       '../moving_averages/WEMA';\r\n\r\nexport class ADXInput extends IndicatorInput {\r\n  high : number[];\r\n  low :number[];\r\n  close : number[];\r\n  period : number;\r\n};\r\n\r\nexport class ADXOutput extends IndicatorInput {\r\n adx : number;\r\n pdi : number;\r\n mdi : number;\r\n};\r\n\r\n\r\n\r\nexport class ADX extends Indicator {\r\n  result : ADXOutput[]\r\n  generator:IterableIterator<ADXOutput | undefined>;;\r\n  constructor(input:ADXInput) {\r\n    super(input);\r\n    var lows = input.low;\r\n    var highs = input.high;\r\n    var closes = input.close;\r\n    var period = input.period;\r\n    var format = this.format;\r\n\r\n    var plusDM = new PDM({\r\n      high: [],\r\n      low : []\r\n    });\r\n\r\n    var minusDM = new MDM({\r\n      high: [],\r\n      low : []\r\n    });\r\n\r\n    var emaPDM = new WilderSmoothing({period: period, values:[], format : (v) => {return v}});\r\n    var emaMDM = new WilderSmoothing({period: period, values:[], format : (v) => {return v}});\r\n    var emaTR  = new WilderSmoothing({period: period, values:[], format : (v) => {return v}});\r\n    var emaDX  = new WEMA({period: period, values:[], format : (v) => {return v}});\r\n\r\n    var tr    = new TrueRange({\r\n      low : [],\r\n      high: [],\r\n      close: [],\r\n    });\r\n\r\n    if(!((lows.length === highs.length) && (highs.length === closes.length) )){\r\n      throw ('Inputs(low,high, close) not of equal size');\r\n    }\r\n\r\n    this.result = [];\r\nADXOutput\r\n    this.generator = (function* (){\r\n      var tick = yield;\r\n      var index = 0;\r\n      var lastATR,lastAPDM,lastAMDM,lastPDI,lastMDI,lastDX,smoothedDX;\r\n      lastATR = 0;\r\n      lastAPDM = 0;\r\n      lastAMDM = 0;\r\n      while (true) {\r\n        let calcTr = tr.nextValue(tick);\r\n        let calcPDM = plusDM.nextValue(tick);\r\n        let calcMDM = minusDM.nextValue(tick);\r\n        if(calcTr === undefined){\r\n          tick = yield;\r\n          continue;\r\n        }\r\n        let lastATR = emaTR.nextValue(calcTr)\r\n        let lastAPDM  = emaPDM.nextValue(calcPDM);\r\n        let lastAMDM  = emaMDM.nextValue(calcMDM);\r\n        if((lastATR != undefined) && (lastAPDM != undefined) && (lastAMDM != undefined)) {\r\n          lastPDI = (lastAPDM) * 100 / lastATR;\r\n          lastMDI = (lastAMDM) * 100 / lastATR;\r\n          let diDiff = Math.abs(lastPDI - lastMDI);\r\n          let diSum = (lastPDI + lastMDI);\r\n          lastDX = (diDiff / diSum) * 100;\r\n          smoothedDX = emaDX.nextValue(lastDX)\r\n          // console.log(tick.high.toFixed(2), tick.low.toFixed(2), tick.close.toFixed(2) , calcTr.toFixed(2), calcPDM.toFixed(2), calcMDM.toFixed(2), lastATR.toFixed(2), lastAPDM.toFixed(2), lastAMDM.toFixed(2), lastPDI.toFixed(2), lastMDI.toFixed(2), diDiff.toFixed(2), diSum.toFixed(2), lastDX.toFixed(2));\r\n        } \r\n        tick = yield { adx : smoothedDX, pdi : lastPDI, mdi : lastMDI };\r\n      }\r\n    })();\r\n\r\n    this.generator.next();\r\n\r\n    lows.forEach((tick,index) => {\r\n      var result = this.generator.next({\r\n        high : highs[index],\r\n        low  : lows[index],\r\n        close : closes[index]\r\n      });\r\n      if(result.value != undefined && result.value.adx != undefined){\r\n        this.result.push({ adx : format(result.value.adx), pdi : format(result.value.pdi), mdi : format(result.value.mdi) });\r\n      }\r\n    });\r\n  };\r\n\r\n  static calculate = adx;\r\n\r\n  nextValue(price:number):ADXOutput | undefined {\r\n      let result = this.generator.next(price).value;\r\n      if(result != undefined && result.adx != undefined) {\r\n        return { adx : this.format(result.adx), pdi : this.format(result.pdi), mdi : this.format(result.mdi) };\r\n      }\r\n  };\r\n}\r\n\r\nexport function adx(input:ADXInput):ADXOutput[] {\r\n    Indicator.reverseInputs(input);\r\n    var result = new ADX(input).result;\r\n    if(input.reversedInput) {\r\n        result.reverse();\r\n    }\r\n    Indicator.reverseInputs(input);\r\n    return result;\r\n  };"],"mappings":"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","ignoreList":[]}